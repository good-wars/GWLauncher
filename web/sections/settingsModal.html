<div id="settings-mmodal" class="modal-bg hidden">
  <div class="modal-window bg-primary-1100 flex flex-col">
    <div class="flex items-center mb-2">
      <div class="flex grow">
        <div
          class="modal-caption modal-tabs active"
          data-tab="game-settings-tab"
        >
          Настройки игры
        </div>
        <div class="modal-caption modal-tabs" data-tab="launcher-settings-tab">
          Настройки лаунчера
        </div>
        <div class="modal-caption modal-tabs" data-tab="about-launcher-tab">
          О лаунчере
        </div>
      </div>
      <button
        type="button"
        class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ml-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white"
        onclick="FrogUI.goHomeSection()"
      >
        <span class="material-symbols-rounded">close</span>
      </button>
    </div>

    <div class="modal-themes-tab" id="game-settings-tab">
      <!-- Memory setup -->
      <div class="flex my-3">
        <p>Выделение памяти (Гб)</p>
        <span
          class="material-symbols-rounded text-primary-700 ml-3"
          id="showMemTooltip"
          >help</span
        >
      </div>

      <input
        type="number"
        id="memInput"
        class="custom-input"
        min="0.5"
        step="0.5"
      />

      <!-- Java version selector -->
      <p class="my-3">Версия Java</p>
      <select class="custom-input" id="javaSelect"></select>

      <!-- Game directory setup -->
      <p class="my-3">Папка для хранения файлов игры</p>
      <div class="flex items-center">
        <input
          type="text"
          class="custom-input"
          readonly
          style="height: 48px"
          id="gamePathInput"
        />
        <button
          id="selectPathButton"
          class="bg-primary-1000 rounded-lg ml-3 p-0"
          style="width: 48px; height: 48px"
          onclick="FrogBackendCommunicator.openGameDirectoryDialog()"
        >
          <span class="material-symbols-rounded" style="padding-top: 4px"
            >folder_open</span
          >
        </button>
      </div>

      <!-- Game resources store select -->
      <p class="my-3">
        Где хранить ресурсы игры (папки saves, resourcepacks и др.)
      </p>
      <select class="custom-input" id="gameResStoreSelect">
        <option value="root">В общей папке игры</option>
        <option value="ver">Отдельно для каждой версии игры</option>
      </select>

      <!-- Fabric API auto-install switch -->
      <div class="flex items-center my-3">
        <span class="text-white text-lg mr-2"
          >Автоматически устанавливать мод FabricAPI для версий Fabric</span
        >
        <label class="switch">
          <input type="checkbox" id="autoFabricAPICheckbox" />
          <span class="slider round"></span>
        </label>
      </div>
    </div>

    <div
      class="modal-themes-tab hidden h-full flex flex-col"
      id="launcher-settings-tab"
    >
      <div class="flex items-center my-3">
        <span class="text-white text-lg mr-2"
          >Открывать консоль разработчика при запуске</span
        >
        <label class="switch">
          <input type="checkbox" id="openConsoleOnStartCheckbox" />
          <span class="slider round"></span>
        </label>
      </div>

      <div class="flex items-center my-3">
        <span class="text-white text-lg mr-2"
          >Скрывать лаунчер при запуске игры</span
        >
        <label class="switch">
          <input type="checkbox" id="disappearOnStartCheckbox" />
          <span class="slider round"></span>
        </label>
      </div>

      <div class="flex items-center my-3">
        <span class="text-white text-lg mr-2"
          >Разрешить воспроизведение звуков интерфейса</span
        >
        <label class="switch">
          <input type="checkbox" id="interfaceSoundsCheckbox" />
          <span class="slider round"></span>
        </label>
      </div>

      <div class="grow"></div>

      <button
        type="button"
        onclick="FrogConfigManager.writeDefaultMainConfig(); FrogBackendCommunicator.restartLauncher();"
        class="mb-3 focus:outline-none text-white bg-red-700 hover:bg-red-800 font-medium rounded-lg text-sm px-5 py-2.5 dark:bg-red-600 dark:hover:bg-red-700"
      >
        Сбросить настройки лаунчера
      </button>
    </div>

    <div
      class="modal-themes-tab hidden h-full flex flex-col"
      id="about-launcher-tab"
    >
      <div class="flex flex-col h-full">
        <div class="flex flex-col w-full my-2 items-center">
          <img
            src="assets/icon-foreground.png"
            class="jabb"
            style="height: 168px"
          />
          <p class="text-white mc-text mt-3 text-3xl">
            GWLauncher <span id="launcher-version" class="mc-text"></span>
          </p>
          <p class="text-white">Developed by Seeroy. Modifired by AstroPowerX</p>
        </div>

        <p class="text-white mc-text text-xl mt-2">
          Используемые шрифты и библиотеки
        </p>
        <div class="grid grid-cols-3 gap-2 mt-2">
          <!-- Material Symbols -->
          <a
            href="#"
            onclick='openExternal("https://fonts.google.com/icons")'
            class="inline-flex items-center justify-center p-5 text-base font-medium text-gray-500 rounded-lg bg-gray-50 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:bg-gray-800 dark:hover:bg-gray-700 dark:hover:text-white"
          >
            <img
              src="assets/google-fonts.svg"
              style="width: 32px"
              class="mr-3"
            />
            <span class="w-full">Material Symbols Rounded</span>
            <svg
              class="w-4 h-4 ml-2"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 14 10"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M1 5h12m0 0L9 1m4 4L9 9"
              />
            </svg>
          </a>
          <!-- fonts-online.ru -->
          <a
            href="#"
            onclick='openExternal("https://fonts-online.ru")'
            class="inline-flex items-center justify-center p-5 text-base font-medium text-gray-500 rounded-lg bg-gray-50 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:bg-gray-800 dark:hover:bg-gray-700 dark:hover:text-white"
          >
            <span class="mr-3 mc-text text-2xl text-white">Aa</span>
            <span class="w-full">Шрифт с Fonts-Online.Ru</span>
            <svg
              class="w-4 h-4 ml-2"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 14 10"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M1 5h12m0 0L9 1m4 4L9 9"
              />
            </svg>
          </a>
          <!-- Electron -->
          <a
            href="#"
            onclick='openExternal("https://electronjs.org")'
            class="inline-flex items-center justify-center p-5 text-base font-medium text-gray-500 rounded-lg bg-gray-50 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:bg-gray-800 dark:hover:bg-gray-700 dark:hover:text-white"
          >
            <img src="assets/electron.png" style="width: 32px" class="mr-3" />
            <span class="w-full">Electron</span>
            <svg
              class="w-4 h-4 ml-2"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 14 10"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M1 5h12m0 0L9 1m4 4L9 9"
              />
            </svg>
          </a>
          <!-- Flowbite -->
          <a
            href="#"
            onclick='openExternal("https://flowbite.com")'
            class="inline-flex items-center justify-center p-5 text-base font-medium text-gray-500 rounded-lg bg-gray-50 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:bg-gray-800 dark:hover:bg-gray-700 dark:hover:text-white"
          >
            <img src="assets/flowbite.png" style="width: 32px" class="mr-3" />
            <span class="w-full">Flowbite</span>
            <svg
              class="w-4 h-4 ml-2"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 14 10"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M1 5h12m0 0L9 1m4 4L9 9"
              />
            </svg>
          </a>
          <!-- minecraft-launcher-core -->
          <a
            href="#"
            onclick='openExternal("https://github.com/Pierce01/MinecraftLauncher-core")'
            class="inline-flex items-center justify-center p-5 text-base font-medium text-gray-500 rounded-lg bg-gray-50 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:bg-gray-800 dark:hover:bg-gray-700 dark:hover:text-white"
          >
            <img src="assets/mclc.png" style="width: 32px" class="mr-3" />
            <span class="w-full">MCLC</span>
            <svg
              class="w-4 h-4 ml-2"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 14 10"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M1 5h12m0 0L9 1m4 4L9 9"
              />
            </svg>
          </a>
          <!-- Tailwind CSS -->
          <a
            href="#"
            onclick='openExternal("https://tailwindcss.com/")'
            class="inline-flex items-center justify-center p-5 text-base font-medium text-gray-500 rounded-lg bg-gray-50 hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:bg-gray-800 dark:hover:bg-gray-700 dark:hover:text-white"
          >
            <img src="assets/tailwind.svg" style="width: 32px" class="mr-3" />
            <span class="w-full">TailwindCSS</span>
            <svg
              class="w-4 h-4 ml-2"
              aria-hidden="true"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 14 10"
            >
              <path
                stroke="currentColor"
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M1 5h12m0 0L9 1m4 4L9 9"
              />
            </svg>
          </a>
        </div>
      </div>
    </div>

    <div class="grow"></div>

    <button class="custom-button" onclick="saveMainSettings()">
      Сохранить настройки
    </button>
  </div>
  <div
    id="memTooltip"
    class="setup-tooltip flex items-center justify-center hidden"
  >
    <span class="material-symbols-rounded text-white">memory_alt</span>
    <span class="ml-3 text-white"
      >Рекомендуем выделять
      <span class="text-green-500">не менее 2 Гб</span> для ванильной версии и
      <span class="text-blue-500">не менее 4 Гб</span> для версии с
      модификациями</span
    >
  </div>
</div>

<style>
  .setup-tooltip {
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    width: max-content;
    height: max-content;
    padding: 24px;
    border-radius: 12px;
    background: var(--bg-primary-1000);
    z-index: 20;
    width: 380px;
    pointer-events: none;
  }

  .setup-tooltip .material-symbols-rounded {
    font-size: 20pt;
  }

  input,
  select {
    width: 100%;
  }
</style>

<script>
  const AUTO_JAVA_ITEM =
    "<option value='auto'>Автоматически скачать и использовать подходящую версию</option>";

  $("#settings-mmodal .modal-tabs").click(function () {
    if (!$(this).hasClass("active")) {
      $("#settings-mmodal .modal-tabs.active").removeClass("active");
      $(this).addClass("active");
      $("#settings-mmodal .modal-themes-tab:not(.hidden)").addClass("hidden");
      $("#" + $(this).data("tab")).removeClass("hidden");
    }
  });

  $("#showMemTooltip").hover(function () {
    FrogUI.refreshAbsoluteElementsPositions();
    $("#memTooltip").removeClass("hidden");
    animateCSS("#memTooltip", "fadeIn");
  });

  $("#showMemTooltip").mouseleave(function () {
    $("#memTooltip").addClass("hidden");
  });

  $(document).ready(function () {
    // Loading Java list
    $("#javaSelect").append(AUTO_JAVA_ITEM);
    FrogInfo.getJavaBinariesList().forEach((element) => {
      $("#javaSelect").append(
        "<option value='" + element + "'>" + element + "</option>"
      );
    });

    // Refreshing memory input max and val
    $("#memInput").val(mainConfig.selectedMemorySize);
    $("#memInput").attr("max", (FrogInfo.getMaxRAMSize() / 1024).toFixed(1));

    // Refreshing Java select
    if (mainConfig.selectedJava == "auto") {
      $("#javaSelect option[value='auto']").prop("selected", true);
    } else {
      if (
        $("#javaSelect option[value='" + mainConfig.selectedJava + "']")
          .length > 0
      ) {
        $("#javaSelect option[value='" + mainConfig.selectedJava + "']").prop(
          "selected",
          true
        );
      } else {
        $("#javaSelect option[value='auto']").prop("selected", true);
        mainConfig.selectedJava = "auto";
        FrogConfigManager.writeAndRefreshMainConfig(mainConfig);
      }
    }

    if(mainConfig.storeGameResInRoot == true){
      $("#gameResStoreSelect option[value='root']").prop("selected", true);
    } else {
      $("#gameResStoreSelect option[value='ver']").prop("selected", true);
    }

    // Refreshing game path
    $("#gamePathInput").val(mainConfig.selectedBaseDirectory);

    // Securing memInput from entering value bigger than max
    $("#memInput").change(function () {
      if ($(this).val() > parseInt($(this).attr("max"))) {
        $(this).val(parseInt($(this).attr("max")));
      }
      if ($(this).val() < $(this).attr("min")) {
        $(this).val($(this).attr("min"));
      }
    });

    if (mainConfig.openConsoleOnStart == true) {
      $("#openConsoleOnStartCheckbox").prop("checked", true);
    }

    if (mainConfig.autoInstallFabricAPI == true) {
      $("#autoFabricAPICheckbox").prop("checked", true);
    }

    if (mainConfig.enableSounds == true) {
      $("#interfaceSoundsCheckbox").prop("checked", true);
    }

    if (mainConfig.disappearOnStart == true) {
      $("#disappearOnStartCheckbox").prop("checked", true);
    }

    // Handle game directory selection
    ipcRenderer.on("get-gd-result", (event, arg) => {
      if (arg != false) {
        $("#settings-mmodal #gamePathInput").val(arg);
      }
    });
  });

  function saveMainSettings() {
    mainConfig.selectedJava = $("#javaSelect option:selected").val();
    mainConfig.selectedMemorySize = $("#memInput").val();
    mainConfig.selectedBaseDirectory = $("#gamePathInput").val();
    FrogUtils.createNeccesaryDirs();
    mainConfig.openConsoleOnStart = $("#openConsoleOnStartCheckbox").is(
      ":checked"
    );
    mainConfig.enableSounds = mainConfig.enableDiscordPresence = $(
      "#interfaceSoundsCheckbox"
    ).is(":checked");
    mainConfig.enableDiscordPresence = $("#discordrpcCheckbox").is(":checked");
    mainConfig.disappearOnStart = $("#disappearOnStartCheckbox").is(":checked");
    mainConfig.autoInstallFabricAPI = $("#autoFabricAPICheckbox").is(
      ":checked"
    );
    if($("#gameResStoreSelect option[value='root']").is(":selected")){
      mainConfig.storeGameResInRoot = true;
    } else {
      mainConfig.storeGameResInRoot = false;
    }
    if (mainConfig.enableDownloadManager == true) {
      $(".downloads-container").removeClass("disabled");
    } else {
      $(".downloads-container").addClass("disabled");
    }
    FrogConfigManager.writeAndRefreshMainConfig(mainConfig);
    FrogVersionsUI.resetCatSelectors();
    FrogVersionsUI.refreshVersionsListModal();
    Toaster("Настройки успешно сохранены", 2000, false, "success");
    FrogUI.goHomeSection();
  }
</script>
